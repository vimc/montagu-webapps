version: '2'
services:
  proxy:
    image: docker.montagu.dide.ic.ac.uk:5000/montagu-reverse-proxy-minimal:master
    ports:
      - 80:80
    depends_on:
      - api
  api:
    image: docker.montagu.dide.ic.ac.uk:5000/montagu-api:${MONTAGU_API_VERSION}
    ports:
      - "8080:8080"
    depends_on:
      - db
    volumes:
      - ${TOKEN_KEY_PATH}:/etc/montagu/api/token_key
  db:
    image: docker.montagu.dide.ic.ac.uk:5000/montagu-db:${MONTAGU_DB_VERSION}
    ports:
      - "5432:5432"
    command: /etc/montagu/postgresql.test.conf
  db_annex:
    image: docker.montagu.dide.ic.ac.uk:5000/montagu-db:${MONTAGU_DB_VERSION}
    command: /etc/montagu/postgresql.test.conf
